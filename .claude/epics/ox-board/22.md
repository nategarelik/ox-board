---
id: 22
title: Fix React lazy loading and AudioContext errors in ox-board
status: todo
created: 2025-01-16T22:07:00Z
updated: 2025-01-16T22:07:00Z
assigned:
type: bug
priority: high
epic: ox-board
github: https://github.com/nategarelik/ox-board/issues/22
dependencies: []
effort: 3
---

# Task 22: Fix React lazy loading and AudioContext errors in ox-board

## Problem Statement

The application is showing multiple critical errors in the console that prevent proper functionality:

1. **React Lazy Loading Error**: Components using React.lazy() are failing to load properly
2. **AudioContext Autoplay Policy**: Tone.js can't start AudioContext without user interaction
3. **Hydration Mismatch**: SSR/client HTML differences

## Root Causes

### 1. Lazy Loading Issue
- Incorrect export/import syntax with lazy components
- Likely using `export default` instead of named exports
- Or missing proper default export in lazy-loaded modules

### 2. AudioContext Initialization
- Tone.js trying to start AudioContext on page load
- Browser blocks this due to autoplay policy
- Need user gesture to start audio context

### 3. Hydration Mismatch
- VS Code browser extension adding styles
- Server render doesn't match client

## Implementation Plan

### Phase 1: Fix Lazy Loading
1. Identify all lazy-loaded components in the codebase
2. Fix export syntax (ensure default exports)
3. Update import statements if needed
4. Test each component loads properly

### Phase 2: Fix AudioContext
1. Delay Tone.js initialization
2. Add "Start Audio" button or use first user interaction
3. Initialize AudioContext only after user gesture
4. Update all audio-related components

### Phase 3: Fix Hydration
1. Check for browser extension interference
2. Ensure consistent rendering between server/client
3. Remove any dynamic styles that differ

## Files to Modify

### Lazy Loading Fixes
- `app/page.tsx` - Check lazy imports
- `app/components/` - Any lazy-loaded components
- Component exports that use React.lazy()

### AudioContext Fixes
- `app/lib/audio/` - Audio initialization
- `app/components/DJ/` - DJ components using Tone.js
- `app/stores/` - Store initialization of audio

### Hydration Fixes
- `app/layout.tsx` - Check for dynamic styles
- `_document.tsx` if exists
- Any SSR-specific code

## Success Criteria

- [ ] No console errors on page load
- [ ] All components render properly
- [ ] Audio starts after user interaction
- [ ] No hydration warnings
- [ ] Application fully functional

## Testing

1. Clear browser cache
2. Load application in incognito mode
3. Check console for errors
4. Test all lazy-loaded components
5. Test audio functionality
6. Verify SSR/client consistency